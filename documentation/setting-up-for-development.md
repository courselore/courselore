# Setting Up for Development

CourseLore has been designed to be welcoming to new developers. It’s an excellent first project for people who are new to contributing to open-source software.

> **Note:** If you get stuck, please [open an issue](https://github.com/courselore/courselore/issues/new) including as much information as possible: What you tried, what you expected to happen, what really happened, what error messages you ran into, and so forth.

### Running a Pre-Compiled Binary Locally

The best way to get started is to run a pre-compiled CourseLore binary on your machine. You may download CourseLore from two channels: The latest development versions, which are available as [Actions Artifacts](https://github.com/courselore/courselore/actions); and stable versions, which are available as [Releases](https://github.com/courselore/courselore/releases). After you downloaded CourseLore, extract it and run the `courselore` binary.

> **Note:** You must be signed in to GitHub to download GitHub Actions Artifacts.

> **Note:** CourseLore needs some network ports to be available: 80, 443, 4000, and 4001. Stop other applications you may have running on those ports. In macOS and Linux you may find if an application is running on a network port using, for example, `lsof -i:80`.

> **Note:** Most Linux distributions prevent regular users from binding to network ports lower than 1024. This is a setting that [you should disable](https://github.com/small-tech/auto-encrypt/tree/a917892b93b61cd3b80a6f3919db752e2c5a9f6c#a-note-on-linux-and-the-security-farce-that-is-privileged-ports).

> **Note:** CourseLore may ask for your password before running. This happens because it runs with HTTPS—not HTTP—in development to reduce confusion around some browser features that work differently under HTTPS. To accomplish this, it needs to install local TLS certificates on your operating system’s trust base. CourseLore relies on [Caddy](https://caddyserver.com) to manage this process.

### Running from Source

<details>
<summary>Windows</summary>

**Option 1: Windows Subsystem for Linux (WSL)**

If you’re using WSL, follow the Linux instructions.

**Option 2: Native Windows Development Environment**

1. Install [Chocolatey](https://chocolatey.org) and the following packages:

   ```console
   > choco install nvm python visualstudio2022-workload-vctools vscode git
   ```

   > **Note:** You must run PowerShell as administrator for Chocolatey to work.

   > **Note:** You may have to close and reopen PowerShell after installing programs such as Chocolatey and NVM for Windows before you’re able to use them.

   > **Note:** Instead of using Chocolatey, you could go to the websites for the development tools and install them by hand, but Chocolatey makes installation and updates more straightforward.

   > **Package Breakdown**
   >
   > - [NVM for Windows (`nvm`)](https://github.com/coreybutler/nvm-windows): A manager of multiple Node.js installations. While in theory you could install just the latest Node.js version directly from Chocolatey, in practice you’ll often need to test something in different versions of Node.js, particularly when you contribute to the packages on which CourseLore depends, so it’s better to use NVM for Windows from the beginning.
   >
   > - [Python (`python`)](https://www.python.org) and [Visual Studio C++ Build Tools (`visualstudio2022-workload-vctools`)](https://visualstudio.microsoft.com/visual-cpp-build-tools/): These tools are necessary to build native Node.js extensions written in C/C++.
   >
   > - [Visual Studio Code (`vscode`)](https://code.visualstudio.com): A text editor with excellent support for the programming languages used in CourseLore.
   >
   > - [Git (`git`)](https://git-scm.com): The version control system used by CourseLore.

2. Setup Git:

   - [Username](https://docs.github.com/en/get-started/getting-started-with-git/setting-your-username-in-git#setting-your-git-username-for-every-repository-on-your-computer)
   - [Email](https://docs.github.com/en/account-and-profile/setting-up-and-managing-your-github-user-account/managing-email-preferences/setting-your-commit-email-address#setting-your-email-address-for-every-repository-on-your-computer)
   - [Global `.gitignore` for files such as `.DS_Store` generated by Finder in macOS](https://docs.github.com/en/get-started/getting-started-with-git/ignoring-files#configuring-ignored-files-for-all-repositories-on-your-computer)
   - [SSH keys to connect to GitHub](https://docs.github.com/en/authentication/connecting-to-github-with-ssh).

3. Install the latest version of Node.js with NVM for Windows:

   ```console
   > nvm install latest
   ```

4. Install the following Visual Studio Code extensions:

   - [Prettier - Code formatter](https://marketplace.visualstudio.com/items?itemName=esbenp.prettier-vscode): Support for [Prettier](https://prettier.io), the code formatter used by CourseLore.
   - [`es6-string-html`](https://marketplace.visualstudio.com/items?itemName=Tobermory.es6-string-html): Syntax highlighting for HTML & SQL as tagged template literals in TypeScript—a feature heavily used in the CourseLore codebase.
   - [Indentation Level Movement](https://marketplace.visualstudio.com/items?itemName=kaiwood.indentation-level-movement): Move up & down by indentation, which helps navigating on HTML.

5. Clone the codebase, install the dependencies, and run CourseLore:

   ```console
   > git clone git@github.com:courselore/courselore.git
   > cd courselore
   > npm install
   > npm start
   ```

</details>

<details>

<summary>macOS</summary>

1. Install [Homebrew](https://brew.sh) and the following packages:

   ```console
   $ brew install nvm visual-studio-code git
   ```

   > **Note:** Instead of using Homebrew, you could go to the websites for the development tools and install them by hand, but Homebrew makes installation and updates more straightforward.

   > **Package Breakdown**
   >
   > - [Node Version Manager (`nvm`)](https://github.com/nvm-sh/nvm): A manager of multiple Node.js installations. While in theory you could install just the latest Node.js version directly from Homebrew, in practice you’ll often need to test something in different versions of Node.js, particularly when you contribute to the packages on which CourseLore depends, so it’s better to use Node Version Manager from the beginning.
   >
   > - [Visual Studio Code (`visual-studio-code`)](https://code.visualstudio.com): A text editor with excellent support for the programming languages used in CourseLore.
   >
   > - [Git (`git`)](https://git-scm.com): The version control system used by CourseLore.

2. Setup Git:

   - [Username](https://docs.github.com/en/get-started/getting-started-with-git/setting-your-username-in-git#setting-your-git-username-for-every-repository-on-your-computer)
   - [Email](https://docs.github.com/en/account-and-profile/setting-up-and-managing-your-github-user-account/managing-email-preferences/setting-your-commit-email-address#setting-your-email-address-for-every-repository-on-your-computer)
   - [Global `.gitignore` for files such as `.DS_Store` generated by Finder in macOS](https://docs.github.com/en/get-started/getting-started-with-git/ignoring-files#configuring-ignored-files-for-all-repositories-on-your-computer)
   - [SSH keys to connect to GitHub](https://docs.github.com/en/authentication/connecting-to-github-with-ssh).

3. Install the latest version of Node.js with Node Version Manager:

   ```console
   $ nvm install node
   ```

4. Install the following Visual Studio Code extensions:

   - [Prettier - Code formatter](https://marketplace.visualstudio.com/items?itemName=esbenp.prettier-vscode): Support for [Prettier](https://prettier.io), the code formatter used by CourseLore.
   - [`es6-string-html`](https://marketplace.visualstudio.com/items?itemName=Tobermory.es6-string-html): Syntax highlighting for HTML & SQL as tagged template literals in TypeScript—a feature heavily used in the CourseLore codebase.
   - [Indentation Level Movement](https://marketplace.visualstudio.com/items?itemName=kaiwood.indentation-level-movement): Move up & down by indentation, which helps navigating on HTML.

5. Clone the codebase, install the dependencies, and run CourseLore:

   ```console
   $ git clone git@github.com:courselore/courselore.git
   $ cd courselore
   $ npm install
   $ npm start
   ```

   > **Note:** macOS imposes a limit on the number of files a process can open, but in development CourseLore needs to open more files than the default setting allows because it reloads code as soon as you change it. Increase the limit by following [these instructions](https://gist.github.com/abernix/a7619b07b687bb97ab573b0dc30928a0).

</details>

<details>

<summary>Linux <a href="https://ubuntu.com">Ubuntu</a>)</summary>

1. Install [Homebrew on Linux](https://docs.brew.sh/Homebrew-on-Linux) and the following packages:

   ```console
   $ brew install nvm git
   $ sudo snap install code --classic
   ```

   > **Note:** Instead of using Homebrew, you could go to the websites for the development tools and install them by hand, but Homebrew makes installation and updates more straightforward.

   > **Package Breakdown**
   >
   > - [Node Version Manager (`nvm`)](https://github.com/nvm-sh/nvm): A manager of multiple Node.js installations. While in theory you could install just the latest Node.js version directly from Homebrew, in practice you’ll often need to test something in different versions of Node.js, particularly when you contribute to the packages on which CourseLore depends, so it’s better to use Node Version Manager from the beginning.
   >
   > - [Git (`git`)](https://git-scm.com): The version control system used by CourseLore.
   >
   > - [Visual Studio Code (`code`)](https://code.visualstudio.com): A text editor with excellent support for the programming languages used in CourseLore.

   > **Why Homebrew for Linux instead of `apt` (a package manager that comes with Ubuntu)?** The packages available from `apt` prioritize stability, so they run behind on the latest releases. This is desirable for long-running servers, but not for development.

   > **Why Homebrew for Linux instead of [Snap](https://snapcraft.io) (another package manager that comes with Ubuntu)?** Snaps use a constrained permissions system that [doesn’t work well with native Node.js extensions written in C/C++](https://github.com/nodejs/snap/issues/3). Note that Snaps are the best option for graphical applications such as Visual Studio Code, which aren’t available in Homebrew for Linux, so in the command above we installed Visual Studio Code from Snap.

2. Setup Git:

   - [Username](https://docs.github.com/en/get-started/getting-started-with-git/setting-your-username-in-git#setting-your-git-username-for-every-repository-on-your-computer)
   - [Email](https://docs.github.com/en/account-and-profile/setting-up-and-managing-your-github-user-account/managing-email-preferences/setting-your-commit-email-address#setting-your-email-address-for-every-repository-on-your-computer)
   - [Global `.gitignore` for files such as `.DS_Store` generated by Finder in macOS](https://docs.github.com/en/get-started/getting-started-with-git/ignoring-files#configuring-ignored-files-for-all-repositories-on-your-computer)
   - [SSH keys to connect to GitHub](https://docs.github.com/en/authentication/connecting-to-github-with-ssh).

3. Install the latest version of Node.js with Node Version Manager:

   ```console
   $ nvm install node
   ```

4. Install the following Visual Studio Code extensions:

   - [Prettier - Code formatter](https://marketplace.visualstudio.com/items?itemName=esbenp.prettier-vscode): Support for [Prettier](https://prettier.io), the code formatter used by CourseLore.
   - [`es6-string-html`](https://marketplace.visualstudio.com/items?itemName=Tobermory.es6-string-html): Syntax highlighting for HTML & SQL as tagged template literals in TypeScript—a feature heavily used in the CourseLore codebase.
   - [Indentation Level Movement](https://marketplace.visualstudio.com/items?itemName=kaiwood.indentation-level-movement): Move up & down by indentation, which helps navigating on HTML.

5. Clone the codebase, install the dependencies, and run CourseLore:

   ```console
   $ git clone git@github.com:courselore/courselore.git
   $ cd courselore
   $ npm install
   $ npm start
   ```

</details>

### Testing on Mobile

You may run CourseLore on your machine and access it from a phone, which is essential to test any user interface changes you may introduce. You may use the same procedure to test on different computers running different operating systems.

#### Option 1: Using the Local Area Network (Preferred)

1. Establish a network route between your development machine running CourseLore and your phone. The exact steps for accomplishing this depends on your network, but in general it’s enough to have your development machine and your phone on the same wifi.

   > **iPhone + Mac Tip:** Connect an iPhone to a Mac with an USB cable and iOS & macOS will establish a route between them. In macOS you may go to System Preferences… > Sharing to find the address you should use in the browser on the iPhone.

2. Send the development TLS certificates created by [Caddy](https://caddyserver.com) to the phone.

   > **Example:** In the author’s development machine running macOS the certificate is found at `~/Library/Application Support/Caddy/certificates/local/leafac.local/leafac.local.crt`. It’s possible to AirDrop that file to an iPhone.

   > **Note:** Certificates have a `.crt` extension. **Importantly, `.key` files are not certificates.** These files are signing keys which shouldn’t leave your development machine. Anyone with access to that file could intercept and tamper with any network traffic.

3. Trust the TLS certificate on the phone.

   > **Note:** The exact procedure depends on the operating system you’re running, but typically this process occurs in two steps: First **install** the certificate, then **trust** it.

   > **iPhone Tip:** Certificates are configured in Settings > General > VPN & Device Management > Configuration Profile.

4. Run CourseLore with the Local Area Network address, for example:

   ```console
   $ env BASE_URL=https://leafac.local npm start
   ```

   > **Note:** The address must start with `https`, not `http`. CourseLore runs with HTTPS—not HTTP—in development to reduce confusion around some browser features that work differently under HTTPS.

5. Visit the address on the phone.

#### Option 2: Using an SSH Tunnel through a Server That You Have Access to

1. Follow the instructions from Option 1 to transfer a certificate to the phone.

2. On the server that you have access to, open an SSH tunnel, for example, on Ubuntu:

   - Modify `/etc/ssh/sshd_config` to include `GatewayPorts yes`.
   - Run `ssh -NR 0.0.0.0:4001:localhost:4000 root@YOUR-SERVER.COM` and leave the terminal session open.

3. Run CourseLore with the server’s address, for example:

   ```console
   $ env BASE_URL=https://YOUR-SERVER.COM:4000 npm start
   ```

   > **Note:** The address must start with `https`, not `http`. CourseLore runs with HTTPS—not HTTP—in development to reduce confusion around some browser features that work differently under HTTPS.

4. Connect to the tunnel from your machine, for example:

   ```console
   ssh -NR 4001:localhost:4000 root@YOUR-SERVER.COM
   ```

5. Visit the server’s address on the phone.

#### Option 3: Using [Localtunnel](https://localtunnel.me)

1. Install & run Localtunnel following the instructions on the website.

2. Run CourseLore with the Localtunnel address, for example:

   ```console
   $ env BASE_URL=https://THE-LOCAL-TUNNEL-ADDRESS npm start
   ```

   > **Note:** The address must start with `https`, not `http`. CourseLore runs with HTTPS—not HTTP—in development to reduce confusion around some browser features that work differently under HTTPS.

3. Visit the Localtunnel address on the phone.
